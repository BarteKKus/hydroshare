{% extends "pages/page.html" %}

{% load mezzanine_tags pages_tags hydroshare_tags %}

{% block extra_head %}
    <link href="{{ STATIC_URL }}css/site_base_irods.css" rel="stylesheet"/>
{% endblock %}

{% block meta_title %}Create resource{% endblock %}

{% block main %}
    <div class="container">
        <div id="resource-content" class="row">
            {% block error %}
                {% if validation_error %}
                    <div class="alert alert-danger alert-dismissible" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <strong>Validation Error: {{ validation_error }}</strong>
                    </div>
                {% endif %}
                {% if file_size_error %}
                    <div class="alert alert-danger alert-dismissible" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <strong>Uploaded File Size Error: {{ file_size_error }}</strong>
                    </div>
                {% endif %}
                {% if resource_creation_error %}
                    <div class="alert alert-danger alert-dismissible" role="alert">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <strong>Failed to Create Resource: {{ resource_creation_error }}</strong>
                    </div>
                {% endif %}
            {% endblock %}

            <div class="col-xs-12">
                <h2 class="page-title">Create Resource</h2>
            </div>

            <div class="col-xs-12">
                <label for="dropdown-resource-type" class="col-form-label">Select a resource type</label>
                <div id="dropdown-resource-type" class="dropdown">
                    <div id="select-resource-type" class="resource-type selected-type" data-toggle="dropdown"
                         aria-haspopup="true" aria-expanded="true">
                        <img src="{{ STATIC_URL }}img/resource-icons/generic48x48.png"
                             alt="Generic Resource Icon" class="resource-type-icon"/>
                        <div class="resource-type-name">&nbsp;Generic</div>
                    </div>

                    <ul class="dropdown-menu shadow-md" aria-labelledby="select-resource-type">
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="An arbitrary file or collection of files that are logically grouped together as a resource."
                               data-value="GenericResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/generic48x48.png"
                                     alt="Generic Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Generic</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="A resource that holds a list of other resources in HydroShare."
                               data-value="CollectionResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/collection48x48.png"
                                     alt="Collection Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Collection</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="TODO"
                               data-value="CompositeResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/composite48x48.png"
                                     alt="Composite Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Composite</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="A shortcut (or reference) to an external web application that functions with HydroShare data resources."
                               data-value="ToolResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/webapp48x48.png"
                                     alt="Web App Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Web App</div>
                            </a>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="Multidimensional space-time data. One of the major data types used for hydrological modeling."
                               data-value="NetcdfResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/multidimensional48x48.png"
                                     alt="Multidimensional Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Multidimensional (NetCDF)</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="A specific case of the Model Instance resource that applies to the Soil and Water Assessment Tool."
                               data-value="SWATModelInstanceResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/swat48x48.png"
                                     alt="SWAT Model Instance Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;SWAT Model Instance</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="A specific case of the Model Instance resource that applies to USGS MODFLOW 2000 and later versions."
                               data-value="MODFLOWModelInstanceResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/modflow48x48.png"
                                     alt="Collection Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;MODFLOW Model Instance</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="Describes the software component of a generic model within the water domain."
                               data-value="ModelProgramResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/modelprogram48x48.png"
                                     alt="Model Program Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Model Program</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="Defines the input and output data for a generic hydrological model, for a specific time and place."
                               data-value="ModelInstanceResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/modelinstance48x48.png"
                                     alt="Model Instance Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Model Instance</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="Stores a file containing the code for a script that was used to complete a hydrologic data analysis, modeling, or data management operation."
                               data-value="ScriptResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/script48x48.png"
                                     alt="Script Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Script</div>
                            </a>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="A set of point, line, or polygon features stored in ESRI Shapefile format. "
                               data-value="GeographicFeatureResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/geographicfeature48x48.png"
                                     alt="Geographic Feature Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Geographic Feature (ESRI Shapefiles)</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="Commonly used for representing and managing imagery, digital elevation, and other phenomena which is widely used in hydrological research."
                               data-value="RasterResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/geographicraster48x48.png"
                                     alt="Geographic Raster Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Geographic Raster</div>
                            </a>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="A sequence of individual data values that are ordered in time to record the changing trend of a certain phenomenon."
                               data-value="TimeSeriesResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/timeseries48x48.png"
                                     alt="Time Series Resource Icon" class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;Time Series</div>
                            </a>
                        </li>
                        <li>
                            <a data-toggle="tooltip" data-placement="right"
                               title="A reference to a time series stored in a HydroServer that is available via a WaterOneFlow web service in WaterML format."
                               data-value="RefTimeSeriesResource">
                                <img src="{{ STATIC_URL }}img/resource-icons/his48x48.png"
                                     alt="HIS Referenced Time Series Resource Icon"
                                     class="resource-type-icon"/>
                                <div class="resource-type-name">&nbsp;HIS Referenced Time Series</div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <br>

            <label for="title" class="col-xs-12 col-form-label">Choose a title</label>

            <div class="col-xs-12">
                <input id="txtTitle" placeholder="Untitled Resource" class="form-control" type="text">
                <br>
            </div>

            <div id="upload-content" class="col-xs-12">
                <div class="row">
                    <label for="title" class="col-xs-12 col-form-label">Add your files</label>
                    <div class="col-xs-12 col-sm-8 col-md-9">
                        <form id="hsDropzone" class="dropzone" role="form" method="POST"
                              enctype="multipart/form-data"
                              action="/hsapi/_internal/create-resource/do/">
                            {% csrf_token %}

                            <div class="hs-dropzone-header">
                                <i class="fa fa-info-circle" aria-hidden="true"></i>
                                <span>Drop files below or click to upload.</span>
                                <span id="btn-remove-all-files" class="btn btn-default pull-right">
                                    <i class="fa fa-trash-o btn-remove" aria-hidden="true"></i>
                                    <span>&nbsp;&nbsp;Remove All Files</span>
                                </span>
                            </div>

                            <div class="hs-dropzone-wrapper">
                                <div id="dz-container">
                                    <input id="form-title" type="hidden" name="title" value="Some Resource"/>
                                    <input id="form-resource-type" type="hidden" name="resource-type"
                                           value="GenericResource"/>
                                </div>
                            </div>

                            <div class="hs-dropzone-footer">
                                <div id="file-types">
                                    <i class="fa fa-check-circle" aria-hidden="true"></i>
                                    <span>Any file type can be uploaded.</span>
                                </div>
                            </div>

                            <div class="hs-dropzone-footer">
                                <div id="file-multiple">
                                    <i class="fa fa-check-circle" aria-hidden="true"></i>
                                    <span>Multiple file upload is allowed.</span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-xs-12">
                                    <br>
                                    <span>To load files from an iRODS server including your iRODS user HydroShare server:</span>

                                    <div id="irods-browse">
                                            <span id="log-into-irods">
                                                <a id="btn-signin-irods" type="button" class="btn btn-default"
                                                   data-toggle="modal"
                                                   data-target="#irodsSignin"><span
                                                        class="glyphicon glyphicon-log-in"></span>&nbsp;&nbsp;Log in to iRODS...</a>
                                            </span>
                                        <input type="hidden" id="irods-username" name="irods-username" value="">
                                        <input type="hidden" id="irods-password" name="irods-password" value="">
                                        <input type="hidden" id="irods-host" name="irods-host" value="">
                                        <input type="hidden" id="irods-port" name="irods-port" value="">
                                        <input type="hidden" id="irods-zone" name="irods-zone" value="">
                                        <input type="hidden" id="irods_file_names" name="irods_file_names" value="">
                                        <input type="hidden" id="irods_federated" name="irods_federated" value="">
                                        <span id="sign-in-info"></span>
                                        <a id="btn-select-irods-file" type="button"
                                           class="btn btn-default hidden-form"
                                           data-toggle="modal" data-target="#irodsContent">
                                            Browse iRODS...
                                        </a>
                                        <span id="irods-sel-file"></span>
                                        <input type="hidden" id="copy-or-move" name="copy-or-move" value='copy'>
                                        <span id="irods-copy-move" class="hidden-form">
                                                <input type="radio" id='copy-radio' name="copy-move" value="copy"
                                                       checked="checked"> Copy
                                                <input type="radio" id='move-radio' name="copy-move" value="move"> Move
                                            </span>
                                        <a id="btn-signout-irods" type="button" class="btn-link hidden-form">log out
                                            of
                                            iRODS</a>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <div id="preview-template" class="dz-preview dz-file-preview" style="display: none;">
                            <div class="dz-details shadow-md">
                                <div class="dz-details-header">
                                    <div class="dz-size text-muted pull-left" data-dz-size></div>
                                    <i class="fa fa-trash-o btn-remove pull-right" data-toggle="tooltip"
                                       data-placement="bottom" title="Remove this file" aria-hidden="true"
                                       data-dz-remove></i>
                                </div>

                                <i class="fa fa-file-o fa-2x" aria-hidden="true"></i>
                                <div class="dz-error-message arrow_box arrow_box_top_center">
                                    <span data-dz-errormessage></span>
                                </div>

                                <div class="dz-filename" data-toggle="tooltip" data-placement="bottom"
                                     title=""><span data-dz-name></span></div>
                            </div>
                        </div>

                        <br>

                        <h2 id="file-move-warning" class="text-red hidden-form">You selected move option which will
                            move
                            the selected files out of your iRODS account into a HydroShare resource once
                            created. </h2>
                        <h2 class="text-red">{{ file_size_error }}</h2>
                        <h2 id="file-type-error" class="text-red">{{ validation_error }}</h2>
                    </div>

                    <div class="col-xs-12 col-sm-4 col-md-3">
                        <ul class="list-group">
                            <li class="list-group-item">Files you upload here will be grouped together into a
                                "Resource" in HydroShare.
                            </li>
                            <li class="list-group-item">File size is limited to 1 GB per file for direct browser
                                upload from your local disk.
                            </li>
                            <li class="list-group-item">Files larger than 1GB can be imported directly from any
                                iRODS account. You can create
                                a HydroShare iRODS account from your <a href="/user/{{ user.id }}/">User Profile</a>
                                page.
                                See <a href="https://pages.hydroshare.org/">Help</a> for information on working with
                                iRODS directly.
                            </li>
                            <li class="list-group-item"> You can also add files directly from any iRODS server
                                regardless of the file size.
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-xs-12">
                <span id="btn-create-resource" class="btn btn-primary">Create Resource</span>
            </div>
        </div>
    </div>

    {% block modal %}
        {% include "irods_signin.html" %}
        {% include "irods_upload_create.html" %}
    {% endblock %}


{#    <div class="container">#}
{#        <div class="row">#}
{#            {% block error %}#}
{#                {%  if validation_error %}#}
{#                    <div class="alert alert-danger alert-dismissible" role="alert">#}
{#                          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>#}
{#                          <strong>Validation Error: {{ validation_error }}</strong>#}
{#                     </div>#}
{#                {%  endif %}#}
{#                {%  if file_size_error %}#}
{#                    <div class="alert alert-danger alert-dismissible" role="alert">#}
{#                          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>#}
{#                          <strong>Uploaded File Size Error: {{ file_size_error }}</strong>#}
{#                     </div>#}
{#                {%  endif %}#}
{#                {%  if resource_creation_error %}#}
{#                    <div class="alert alert-danger alert-dismissible" role="alert">#}
{#                          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>#}
{#                          <strong>Failed to Create Resource: {{ resource_creation_error }}</strong>#}
{#                     </div>#}
{#                {%  endif %}#}
{#            {% endblock %}#}
{##}
{#            <h2>Select a resource type and upload files as needed to create a new resource</h2>#}
{##}
{#            <ul>#}
{#                <li>Files you upload here will be grouped together into a "Resource" in HydroShare.</li>#}
{#                <li>File size is limited to 1 GB per file for direct browser upload from your local disk.</li>#}
{#                <li>Files larger than 1GB can be imported directly from any iRODS account. You can create#}
{#                    a HydroShare iRODS account from your <a href="/user/{{ user.id }}/">user profile</a> page.#}
{#                    See help for information on working with iRODS directly.#}
{#                </li>#}
{#                <li> You can also add files directly from any iRODS server regardless of the file size.</li>#}
{#            </ul>#}
{##}
{#            <form class="form-horizontal" role="form" method="POST" enctype="multipart/form-data" action="/hsapi/_internal/create-resource/do/">#}
{#                {% csrf_token %}#}
{#                <div class="form-group">#}
{#                    <label for="" class="col-sm-2 control-label">Select a resource type</label>#}
{##}
{#                    <div class="col-sm-10">#}
{#                        <select class="form-control" name="resource-type" id="resource-type">#}
{#                            <option value="GenericResource">Generic</option>#}
{#                            <option value="NetcdfResource">Multidimensional (NetCDF)</option>#}
{#                            <option value="ToolResource">Web App</option>#}
{#                            <option value="CollectionResource">Collection Resource</option>#}
{#                            <option value="CompositeResource">Composite Resource</option>#}
{##}
{#                            <optgroup label="Geographic Resources">#}
{#                                <option value="RasterResource">Geographic Raster</option>#}
{#                                <option value="GeographicFeatureResource">Geographic Feature (ESRI Shapefiles)</option>#}
{#                            </optgroup>#}
{##}
{#                            <optgroup label="Time Series Resources">#}
{#                                <option value="TimeSeriesResource">Time Series</option>#}
{#                                <option value="RefTimeSeriesResource">HIS Referenced Time Series</option>#}
{#                            </optgroup>#}
{##}
{#                            <optgroup label="Modeling">#}
{#                                <option value="ModelProgramResource">Model Program</option>#}
{#                                <option value="ModelInstanceResource">Model Instance</option>#}
{#                                <option value="SWATModelInstanceResource">SWAT Model Instance</option>#}
{#                                <option value="MODFLOWModelInstanceResource">MODFLOW Model Instance</option>#}
{#                                <option value="ScriptResource">Script</option>#}
{#                            </optgroup>#}
{##}
{#                        </select>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="form-group">#}
{#                    <label for="" class="col-sm-2 control-label">Title</label>#}
{#                    <div class="col-sm-10">#}
{#                      <input type="text" class="form-control" name="title" id="title" placeholder="Untitled resource">#}
{#                    </div>#}
{#                </div>#}
{#                <div id="upload-file">#}
{#                    <h3>Add your files here:</h3>#}
{#                    <table class="table" id="file-list">#}
{#                    <tbody id="files">#}
{#                        <tr>#}
{#                            <td>To load files from your local disk with file size limited to 1GB per file:#}
{#                                <input type="file" class="btn-add-access" name="files" id="select-file" multiple/>#}
{#                            </td>#}
{#                        </tr>#}
{##}
{#                        <tr>#}
{#                            <td>#}
{#                                To load files from an iRODS server including your iRODS user HydroShare server:#}
{#                                <div id="irods-browse">#}
{#                                    <span id="log-into-irods">#}
{#                                        <a id="btn-signin-irods" type="button" class="btn-link" data-toggle="modal" data-target="#irodsSignin">log in to iRODS</a>#}
{#                                    </span>#}
{#                                    <input type="hidden" id="irods-username" name="irods-username" value="">#}
{#                                    <input type="hidden" id="irods-password" name="irods-password" value="">#}
{#                                    <input type="hidden" id="irods-host" name="irods-host" value="">#}
{#                                    <input type="hidden" id="irods-port" name="irods-port" value="">#}
{#                                    <input type="hidden" id="irods-zone" name="irods-zone" value="">#}
{#                                    <input type="hidden" id="irods_file_names" name="irods_file_names" value="">#}
{#                                    <input type="hidden" id="irods_federated" name="irods_federated" value="">#}
{#                                    <span id="sign-in-info"></span>#}
{#                                    <a id="btn-select-irods-file" type="button" class="btn btn-default hidden-form" data-toggle="modal" data-target="#irodsContent">#}
{#                                        Browse iRODS...#}
{#                                    </a>#}
{#                                    <span id="irods-sel-file"></span>#}
{#                                    <input type="hidden" id="copy-or-move" name="copy-or-move" value='copy'>#}
{#                                    <span id="irods-copy-move" class="hidden-form">#}
{#                                        <input type="radio" id='copy-radio' name="copy-move" value="copy" checked="checked"> Copy#}
{#                                        <input type="radio" id='move-radio' name="copy-move" value="move"> Move#}
{#                                    </span>#}
{#                                    <a id="btn-signout-irods" type="button" class="btn-link hidden-form">log out of iRODS</a>#}
{#                                </div>#}
{#                            </td>#}
{#                        </tr>#}
{#                    </tbody>#}
{#                        <div id="file-types">Any file type can be uploaded.</div>#}
{#                        <div id="file-multiple">Multiple file upload is allowed.</div>#}
{#                    </table>#}
{#                    <h2 id="file-move-warning" class="text-red hidden-form">You selected move option which will move#}
{#                        the selected files out of your iRODS account into a HydroShare resource once created. </h2>#}
{#                    <h2 class="text-red">{{ file_size_error }}</h2>#}
{#                    <h2 id="file-type-error" class="text-red">{{ validation_error }}</h2>#}
{#                </div>#}
{##}
{#                <div class="form-group">#}
{#                    <div class="col-sm-offset-2 col-sm-10">#}
{#                        <button type="submit" class="btn btn-primary btn-lg btn-block">Create Resource</button>#}
{#                    </div>#}
{#                </div>#}
{#            </form>#}
{#            {% block modal %}#}
{#                {% include "irods_signin.html" %}#}
{#                {% include "irods_upload_create.html" %}#}
{#            {% endblock %}#}
{#        </div>#}
{#    </div>#}

    <script type="text/javascript">
        $(document).ready(function () {
            var json_response_file_types = {};
            var json_response_multiple_file = {};
            var selected_file = undefined;
            var myDropzone;

            if (sessionStorage.signininfo) {
                $("#sign-in-info").text(sessionStorage.signininfo);
                $("#btn-select-irods-file").show();
                $("#irods-sel-file").text("No file selected.");
            }

            Dropzone.options.hsDropzone = {
                previewTemplate: document.getElementById('preview-template').innerHTML,
                clickable: "#dz-container",
                previewsContainer: "#dz-container:not(.dz-details)",
                paramName: "files", // The name that will be used to transfer the file
                maxFilesize: 1024, // MB
                autoProcessQueue: false,
                uploadMultiple: true,
                parallelUploads: 99,
                createImageThumbnails: true,
                thumbnailWidth: 20,
                thumbnailHeight: 20,

                init: function () {
                    myDropzone = this;

                    $("#btn-create-resource").click(function () {
                        var title = $("#txtTitle").val().trim();
                        if (!title) {
                            title = $("#txtTitle").attr("placeholder");
                        }

                        $("#form-title").val(title);

                        if (myDropzone.files.length > 0) {
                            myDropzone.processQueue();
                        }
                        else {
                            $("#hsDropzone").submit();
                        }
                    });

                    // The user dragged a file onto the Dropzone
                    this.on("dragenter", function (file) {
                        $("#hsDropzone").toggleClass("hs-dropzone-highlight", true);
                    });

                    // The user dragged a file out of the Dropzone
                    this.on("dragleave", function (event) {
                        $("#hsDropzone").toggleClass("hs-dropzone-highlight", false);
                    });

                    this.on("addedfile", function (file) {
                        // Initialize tooltips
                        var template = $(file.previewElement);
                        template.find(".dz-filename").attr("title", template.find("span[data-dz-name]").text());

                        template.find("[data-toggle='tooltip']").tooltip();

                        if (!myDropzone.options.uploadMultiple && myDropzone.files[1] != null) {
                            this.removeFile(this.files[0]);
                        }
                        $("#hsDropzone").toggleClass("hs-dropzone-highlight", false);
                    });

                    this.on("removedfile", function (file) {
                        $('#hsDropzone .tooltip').remove();
                    });

                    this.on("error", function (file, error) {
                       var template = $(file.previewElement);
                        template.find(".dz-filename").attr("title", template.find("span[data-dz-name]").text());

                        var error = template.find("span[data-dz-errormessage]").text();

                        if (error) {
                            $(template).attr("data-toggle", "tooltip");
                            $(template).attr("data-placement", "top");
                            $(template).attr("title", error);
                        }

                        $('[data-toggle="tooltip"]').tooltip();
                    });

                    this.on('sendingmultiple', function (data, xhr, formData) {
                        $("#upload-content").find("input[name]").each(function () {
                            formData.append($(this).attr("name"), $(this).val());
                        });
                    });
                }
            };

            $('input:radio[name="copy-move"]').change(function () {
                if ($(this).val() == 'move') {
                    $("#copy-or-move").val('move');
                    $("#file-move-warning").show();
                }
                else {
                    $("#copy-or-move").val('copy');
                    $("#file-move-warning").hide();
                }
            });

            $('#dropdown-resource-type li a').click(function () {
{#                $('#irods-sel-file').text("No file selected.");#}

                Dropzone.forElement("#hsDropzone").removeAllFiles(true);

                if (selected_file != undefined) {
                    selected_file.value = '';
                }

                $("#form-resource-type").val($(this).attr("data-value"));

                var template = this.innerHTML;
                $("#select-resource-type")[0].innerHTML = template;

                // Get supported file types
                $.ajax({
                    type: "GET",
                    url: "/hsapi/_internal/" + $(this).attr("data-value") + "/supported-file-types/",
                    success: function (result) {
                        json_response_file_types = JSON.parse(result);

                        if (JSON.parse(json_response_file_types.file_types).length == 0) {
                            $("#upload-content").hide();    // No files needed
                        }
                        else {
                            $("#upload-content").show();

                            var supported_file_types = JSON.parse(json_response_file_types.file_types);

                            $("#file-types").empty();

                            if (supported_file_types != ".*") {
                                // Append message
                                $("#file-types").append("<i class='fa fa-info-circle' aria-hidden='true'></i>" +
                                        "<span>Only the following file types can be uploaded:</span><br>");

                                // Render badge for each file type
                                for (var i = 0; i < supported_file_types.length; i++) {
                                    $("#file-types").append('<span class="badge">' + supported_file_types[i] + '</span>');
                                }

                                // Set controls
                                myDropzone.options.acceptedFiles = supported_file_types.toString();
                                $(myDropzone.hiddenFileInput).attr("accept", supported_file_types.toString());
                            }
                            else {
                                // Append message
                                $("#file-types").append("<i class='fa fa-check-circle' aria-hidden='true'></i>" +
                                        "<span><span>Any file type can be uploaded.</span>");

                                // Set controls
                                myDropzone.options.acceptedFiles = "";
                                $(myDropzone.hiddenFileInput).removeAttr("accept");
                            }
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        $("#file-types").empty();

                        // Append message
                        $("#file-types").append("<i class='fa fa-info-circle' aria-hidden='true'></i>" +
                                        "<span>Error in determining supported file types</span><br>");

                        // Set controls
                        myDropzone.options.acceptedFiles = "";
                        $(myDropzone.hiddenFileInput).removeAttr("accept");
                    }
                });

                // Get multiple files flag value
                $.ajax({
                    type: "GET",
                    url: "/hsapi/_internal/" + $(this).attr("data-value") + "/allow-multiple-file/",
                    success: function (result) {
                        json_response_multiple_file = JSON.parse(result);

                        $("#file-multiple").empty();
                        if (json_response_multiple_file.allow_multiple_file == true) {
                            // Append message
                            $("#file-multiple").append("<i class='fa fa-check-circle' aria-hidden='true'></i>");
                            $("#file-multiple").append("<span>Multiple file upload is allowed.</span>");

                            // Set controls
                            myDropzone.options.uploadMultiple = true;
                            $(myDropzone.hiddenFileInput).attr("multiple", 'multiple');
                        }
                        else {
                            // Append message
                            $("#file-multiple").append("<i class='fa fa-info-circle' aria-hidden='true'></i>");
                            $("#file-multiple").append("<span>Only one file can be uploaded.</span>");

                            // Set controls
                            myDropzone.options.uploadMultiple = false;
                            $(myDropzone.hiddenFileInput).removeAttr('multiple');
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        $("#file-multiple").empty();

                        // Append message
                        $("#file-multiple").append("<i class='fa fa-check-circle' aria-hidden='true'></i>");
                        $("#file-multiple").append("<span>Error in determining if multiple file upload is allowed for this resource type.</span>");

                        // Set controls
                        myDropzone.options.uploadMultiple = true;
                        $(myDropzone.hiddenFileInput).attr("multiple", 'multiple');
                    }
                })
            });

            $("#btn-remove-all-files").click(function() {
                Dropzone.forElement("#hsDropzone").removeAllFiles(true);
            });
        });
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/dropzone.js"></script>
{% endblock %}