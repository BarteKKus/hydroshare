{% extends "base.html" %}
{% load pages_tags mezzanine_tags keyword_tags comment_tags hydroshare_tags %}
{% block meta_title %}Discover{% endblock %}
{% block main %}
    <input type="hidden" id="static-url" value="{{ STATIC_URL }}">
    <div class="container" id="discover-main">
        <div class="row">
            <div class="col-xs-12">
                <h2 class="page-title">Discover</h2>
                <div id="discover-search">
                    <div id="wrapper">
                        <div id="search" class="search-field" @keyup.enter="searchClick('{{ csrf_token }}')">
                            {#                    <input class="form-control" name="query" v-model="searchQuery"#}
                            {#                           @keyup.enter="searchClick('{{ csrf_token }}')">#}
                            <vue-bootstrap-typeahead
                                {#  https://github.com/alexurquhart/vue-bootstrap-typeahead#}
                                :data="{{ vocab }}"
                                v-model="searchQuery"
                                {#  Undocumented https://github.com/alexurquhart/vue-bootstrap-typeahead/issues/19#}
                                ref="searchQuery"
                                {#                    input-class="typeahead-search-input"#}
                                @hit="searchClick('{{ csrf_token }}')"
                                placeholder="">
                            </vue-bootstrap-typeahead>
                            <span class="glyphicon glyphicon-search search-icon"></span>
                        </div>
                        <a href="{% url 'search' %}?mode=advanced">Advanced Search</a>
                    </div>
                    {% if q %}
                        <br/>
                        Searched: <a href="/search/">{{ q }}</a>
                        <br/>
                        Results: {{ itemcount }}<br/>
                    {% endif %}

                    <div v-if="q">
                        <resource-listing sample="{{ resources }}" itemcount="{{ initialitemcount }}"
                                          :columns="gridColumns"
                                          :filter-key="searchQuery">
                        </resource-listing>
                    </div>
                </div>
            </div>

            {#            TODO consider moving to props #}
            <script type="text/javascript">const q = '{{ q }}';</script>

            <script id="resource-listing-template" type="text/x-template">
                <div>
                    {#        <p class="items-counter">#}
                    {#        {{ numItems }} items#}
                    {#        </p>#}
                    <table class="table-hover table-striped resource-custom-table" id="items-discovered">
                        <thead>
                        <tr>
                            <th v-for="key in columns"
                                @click="sortBy(key)"
                                :class="{ active: sortKey == key }">
                                ${key | capitalize}
                                <span class="arrow" :class="sortOrders[key] > 0 ? 'asc' : 'dsc'"></span>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="entry in filteredResources">
                            <td>
                                <span>
                                    <img v-bind:src="{{ STATIC_URL }} + 'img/resource-icons/' + resTypeDict[entry.type] + '48x48.png'"
                                         data-toggle="tooltip" data-placement="right"
                                         :alt="entry.type" :title="entry.type"
                                         class="table-res-type-icon"/>
                                </span>
                            </td>
                            <td>
                                <a :href="entry.link">${entry.name}</a>
                            </td>
                            <!-- temporary placeholder for link column, until header display approach is refactored -->

                            <td>${entry.availability}</td>
                            <td>
                                <a :href="entry.author_link">${entry.author}</a>
                            </td>

                            <!-- temporary placeholder for link column, until header display approach is refactored -->
                            <td>${entry.created}</td>
                            <td>${entry.modified}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </script>

            <script type="text/javascript" src="{{ STATIC_URL }}js/search.js"></script>
        </div>
    </div>
{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/search.css"/>
    <link href="{{ STATIC_URL }}css/vue-bootstrap-typeahead.0.2.6.css" rel="stylesheet">
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    <script type="text/javascript" src="{{ STATIC_URL }}js/vue-2.6.10-dev.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/vue-bootstrap-typeahead.0.2.6.min.js"></script>
{% endblock %}


