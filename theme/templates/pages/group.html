{% extends "pages/page.html" %}
{% load geoanalytics_tags pages_tags mezzanine_tags keyword_tags comment_tags hydroshare_tags %}

{% block main %}

    <div class="collaborate-header">
        <div class="container">
            <div class="col-sm-12">
                <div class="collaborate-nav">
                    <a href="{% url "Collaborate" %}" class="collaborate-nav-item">Find Groups</a>
                    <a href="{% url "MyGroups" %}" class="collaborate-nav-item">My Groups</a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-sm-2">
                {#  Group Picture #}
                {% if group.gaccess.picture and group.gaccess.picture.url %}
                    <div class="group-image-wrapper group-image-wrapper-medium">
                        <div class="group-image" style="background-image: url({{ group.gaccess.picture.url }})"></div>
                    </div>

                {% else %}
                    <div class="group-image-wrapper group-image-wrapper-medium">
                        <div class="group-image group-preview-image-default"
                             style="background-image: url({{ STATIC_URL }}img/home-page/step4.png)"></div>
                    </div>
                {% endif %}
                </div>

                <div class="col-sm-8">
                <h2 class="group-title">{{ group.name }}</h2>
                <h4 class="text-muted">{{ group.gaccess.purpose }}</h4>

                <p>{{ group.gaccess.description }}</p>
            </div>
            <div class="col-sm-2">
                <!-- Single button -->
                <div class="dropdown custom-dropdown">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        {% if profile_user.is_group_owner or profile_user.is_group_editor %}
                            Owner
                            {% else %}
                            Member
                        {% endif %} <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <form action="/hsapi/_internal/unshare-group-with-user/{{ group.id }}/{{ user.id }}/">
                                {% csrf_token %}
                                <a href="#" id="btn-leave-group"><span class="glyphicon glyphicon-hand-left btn-edit"></span>&nbsp;&nbsp;Leave Group</a>
                            </form>
                        </li>
                        {% if profile_user.is_group_owner or profile_user.is_group_editor %}
                            <li>
                                <a href="#" id="btn-edit-group" data-toggle="modal"
                                   data-target="#edit-group-dialog"><span
                                        class="glyphicon glyphicon-pencil btn-edit"></span>&nbsp;&nbsp;Edit Group</a>
                            </li>
                            <li role="separator" class="divider"></li>
                            <li>
                                <form action="/hsapi/_internal/unshare-group-with-user/{{ group.id }}/{{ user.id }}/">
                                    {% csrf_token %}
                                    <a href="#" id="btn-leave-group"><span
                                            class="glyphicon glyphicon-trash btn-remove"></span>&nbsp;&nbsp;Delete Group</a>
                                </form>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>

        <div class="full-width-tabs-container" id="user-profile-tabs">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs full-width-tabs" role="tablist">
                <li role="presentation" class="active">
                    <a href="#overview" aria-controls="overview" role="tab"
                       data-toggle="tab"><i class="glyphicon glyphicon-list-alt"></i> OVERVIEW</a></li>
                <li role="presentation">
                    <a href="#resources" aria-controls="resources" role="tab" data-toggle="tab">
                        <i class="glyphicon glyphicon-file"></i> Resources</a>
                </li>
                <li role="presentation">
                    <a href="#members" aria-controls="members" role="tab" data-toggle="tab">
                        <i class="glyphicon glyphicon-user"></i> MEMBERS</a>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane fade in active" id="overview">
                    <div class="row">
                        <div class="col-sm-12">
{#                            <div class="group-activity-block activity-block start-conversation">#}
{#                                <div style="background-image: url('{{ request.user.userprofile.picture.url }}');"#}
{#                                     class="profile-pic-thumbnail round-image pull-left">#}
{#                                </div>#}
{#                                <h4>Share something</h4>#}
{##}
{#                                <div class="group-activity-comment">#}
{#                                    <fieldset>#}
{#                                        <textarea class="form-control"></textarea>#}
{#                                    </fieldset>#}
{#                                </div>#}
{#                                <a class="btn btn-primary">Post</a>#}
{#                            </div>#}

                            <h4>Recent Activity</h4>

                            {% if group.gaccess.view_resources %}
                                {% for res in group.gaccess.view_resources %}
                                    <div class="group-activity-block activity-block">
                                        <div>
                                            <div class="shared-resource-info">
                                                <span><a href="{{ res.get_absolute_url }}">{{ res.metadata.title }}</a></span>
                                            </div>
                                            <h5><span class="text-muted">Resource type: </span>{{ res|resource_type }}
                                            </h5>
                                            <h5><span class="text-muted">Date: </span>{{ res.created }}</h5>
                                        </div>

                                        {% if res.metadata.description %}
                                            <div class="activity-description col-sm-12" style="max-height: 50px;">
                                                <p class="description"><strong>ABSTRACT: </strong>
                                                </p> {{ res.metadata.description|linebreaks }}
                                            </div>
                                            <div class="show-more-btn btn-default" title="Show less">···</div>
                                        {% endif %}

                                        {#                                <div class="group-activity-comment">#}
                                        {#                                    <fieldset>#}
                                        {#                                        <label>Write a comment</label>#}
                                        {#                                        <textarea class="form-control"></textarea>#}
                                        {#                                    </fieldset>#}
                                        {#                                    <a class="btn btn-primary">Post</a>#}
                                        {#                                </div>#}
                                    </div>
                            {% endfor %}
                                {% else %}
                                <i>No recent activity.</i>
                            {% endif %}


{#                            <div class="group-activity-block activity-block">#}
{#                                <div style="background-image: url('{{ request.user.userprofile.picture.url }}');"#}
{#                                     class="profile-pic-thumbnail round-image pull-left">#}
{#                                </div>#}
{##}
{#                                <div class="metadata-wrapper">#}
{#                                    <div class="shared-resource-info">#}
{#                                        <strong><a href="#">Maurier Ramirez</a></strong>#}
{#                                    </div>#}
{#                                    <h5><span class="text-muted">Date: </span>March 14, 2016, 5:14 p.m.</h5>#}
{#                                </div>#}
{##}
{#                                <div class="activity-description conversation-description col-sm-12" style="max-height: 50px;">#}
{#                                    <p class="description">#}
{#                                    <p>The Viterbi Graduate Student Association (VGSA) represents all the full#}
{#                                        time and part time Master's and Doctoral students in the Viterbi School#}
{#                                        of Engineering. VGSA is the largest student umbrella organization at the#}
{#                                        University of Southern California with over 5,000 active engineering#}
{#                                        graduate student members each year, and has an even greater Alumni#}
{#                                        population. The VGSA promotes professional, academic, and social affairs#}
{#                                        on campus, and is committed to creating a positive student experience at#}
{#                                        USC.Show less</p>#}
{#                                </div>#}
{#                                <div class="show-more-btn btn-default" title="Show less">···</div>#}
{##}
{##}
{#                                <div class="group-activity-comment">#}
{#                                    <fieldset>#}
{#                                        <label>Write a comment</label>#}
{#                                        <textarea class="form-control"></textarea>#}
{#                                    </fieldset>#}
{#                                    <a class="btn btn-primary">Post</a>#}
{#                                </div>#}
{#                            </div>#}

                        </div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane fade" id="members">
                    <div class="row">
                        <div class="col-sm-12 col-md-3">
                            <div class="text-center"><a href="#" class="btn btn-primary" role="button" data-toggle="modal" data-target="#invite-dialog">Invite People</a></div>
                            <br>
                            <table id="members-filter" class="table-user-contributions table table-hover">
                                <tbody>
                                    <tr class="active" data-filter-by="all">
                                        <td><span>All</span></td>
                                        <td><span class="badge" data-filter-by='All'>0</span></td>
                                    </tr>
                                     <tr data-filter-by="edit-user">
                                        <td><span>Owners</span></td>
                                        <td><span class="badge" data-filter-by='Owners'>0</span></td>
                                    </tr>
                                    <tr data-filter-by="pending">
                                        <td><span>Pending</span></td>
                                        <td><span class="badge" data-filter-by='Pending'>0</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-sm-12 col-md-9">
                            {#  All members #}
                            <table data-owner-count="{{ group.gaccess.owners|length }}"
                                   data-edit-count="{{ edit_users|length }}"
                                   data-view-count="{{ view_users|length }}"
                                   data-pending-count="{{ group.gaccess.group_membership_requests|length }}"
                                   id="all-members-table" class="table-members-list active">
                                {% for owner in group.gaccess.owners %}
                                    <tr data-filter-by="creator">
                                        <td>
                                            {% if owner.userprofile.picture and owner.userprofile.picture.url %}
                                                <div style="background-image: url('{{ owner.userprofile.picture.url }}');"
                                                     class="profile-pic-thumbnail round-image pull-left">
                                                </div>
                                            {% else %}
                                                <div class="profile-pic-thumbnail-small round-image user-icon"></div>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <h4><strong><a href="/user/{{ owner.id }}">{{ owner|best_name }}</a></strong></h4>
                                            {% if owner.userprofile.title %}
                                                <span class="text-muted">{{ owner.userprofile.title }}</span>
                                            {% endif %}
                                        </td>
                                        <td>Owner</td>
                                    </tr>
                                {% endfor %}

                                {% for owner in edit_users %}
                                    <tr data-filter-by="edit-user">
                                        <td>
                                            {% if  owner.userprofile.picture and owner.userprofile.picture.url %}
                                                <div style="background-image: url('{{ owner.userprofile.picture.url }}');"
                                                     class="profile-pic-thumbnail round-image pull-left">
                                                </div>
                                            {% else %}
                                                <div class="profile-pic-thumbnail-small round-image user-icon"></div>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <h4><strong><a href="#">{{ owner|best_name }}</a></strong></h4>
                                            <span class="text-muted">{{ owner.userprofile.title }}</span>
                                        </td>
                                        <td>
                                            {% if profile_user.is_group_owner or profile_user.is_group_editor %}
                                                <div class="dropdown custom-dropdown">
                                                <button class="btn btn-default dropdown-toggle" type="button"
                                                        id="roleDropDown-{{ member.id }}" data-toggle="dropdown"
                                                        aria-haspopup="true"
                                                        aria-expanded="true">
                                                    Owner
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu"
                                                    aria-labelledby="roleDropDown-{{ member.id }}">
                                                    <li>
                                                        <form action="/hsapi/_internal/share-group-with-user/{{ group.id }}/{{ owner.id }}/edit/">
                                                            {% csrf_token %}
                                                            <a href="#" class="btn-share-group" data-role="Owner">Owner</a>
                                                        </form>
                                                    </li>
                                                    <li>
                                                        <form action="/hsapi/_internal/share-group-with-user/{{ group.id }}/{{ owner.id }}/view/">
                                                            {% csrf_token %}
                                                            <a href="#" class="btn-share-group" data-role="Member">Member</a>
                                                        </form>
                                                    </li>
                                                    <li role="separator" class="divider"></li>
                                                    <li>
                                                        <form action="/hsapi/_internal/unshare-group-with-user/{{ group.id }}/{{ owner.id }}/">
                                                            {% csrf_token %}
                                                            <a href="#" class="btn-unshare-group">Expel</a>
                                                        </form>
                                                    </li>
                                                </ul>
                                            </div>
                                                {% else %}
                                                Owner
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}

                                {#  Template to generate subsequent rows after accepting join request   #}
                                <tr data-filter-by="view-user" id="templateRow">
                                    <td>
                                        <h4><strong><a href="#" data-id="name"></a></strong></h4>
                                        <span class="text-muted" data-id="title"></span>
                                    </td>
                                    <td>
                                        <div class="dropdown custom-dropdown">
                                            <button class="btn btn-default dropdown-toggle" type="button"
                                                    data-toggle="dropdown" aria-haspopup="true"
                                                    aria-expanded="true">
                                                Member
                                                <span class="caret"></span>
                                            </button>
                                            <ul class="dropdown-menu">
                                                <li>
                                                    <form action="/hsapi/_internal/share-group-with-user/{{ group.id }}/member_id/edit/">
                                                        {% csrf_token %}
                                                        <a href="#" class="btn-share-group"
                                                           data-role="Owner">Owner</a>
                                                    </form>
                                                </li>
                                                <li>
                                                    <form action="/hsapi/_internal/share-group-with-user/{{ group.id }}/member_id/view/">
                                                        {% csrf_token %}
                                                        <a href="#" class="btn-share-group"
                                                           data-role="Member">Member</a>
                                                    </form>
                                                </li>
                                                <li role="separator" class="divider"></li>
                                                <li>
                                                    <form action="/hsapi/_internal/unshare-group-with-user/{{ group.id }}/member_id/">
                                                        {% csrf_token %}
                                                        <a href="#" class="btn-unshare-group">Expel</a>
                                                    </form>
                                                </li>
                                            </ul>
                                        </div>

                                    </td>
                                </tr>

                                {% for member in view_users %}
                                    <tr data-filter-by="view-user">
                                        <td>
                                            {% if member.userprofile.picture and member.userprofile.picture.url %}
                                                <div style="background-image: url('{{ member.userprofile.picture.url }}');"
                                                     class="profile-pic-thumbnail round-image pull-left">
                                                </div>
                                            {% else %}
                                                <div class="profile-pic-thumbnail-small round-image user-icon"></div>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <h4><strong><a href="#">{{ member|best_name }}</a></strong></h4>
                                            {% if  member.userprofile.title %}
                                                <span class="text-muted">{{ member.userprofile.title }}</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if profile_user.is_group_owner or profile_user.is_group_editor %}
                                            <div class="dropdown custom-dropdown">
                                                <button class="btn btn-default dropdown-toggle" type="button"
                                                        id="roleDropDown-{{ member.id }}" data-toggle="dropdown"
                                                        aria-haspopup="true"
                                                        aria-expanded="true">
                                                    Member
                                                    <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu"
                                                    aria-labelledby="roleDropDown-{{ member.id }}">
                                                    <li>
                                                        <form action="/hsapi/_internal/share-group-with-user/{{ group.id }}/{{ member.id }}/edit/">
                                                            {% csrf_token %}
                                                            <a href="#" class="btn-share-group" data-role="Owner">Owner</a>
                                                        </form>
                                                    </li>
                                                    <li>
                                                        <form action="/hsapi/_internal/share-group-with-user/{{ group.id }}/{{ member.id }}/view/">
                                                            {% csrf_token %}
                                                            <a href="#" class="btn-share-group" data-role="Member">Member</a>
                                                        </form>
                                                    </li>
                                                    <li role="separator" class="divider"></li>
                                                    <li>
                                                        <form action="/hsapi/_internal/unshare-group-with-user/{{ group.id }}/{{ member.id }}/">
                                                            {% csrf_token %}
                                                            <a href="#" class="btn-unshare-group">Expel</a>
                                                        </form>
                                                    </li>
                                                </ul>
                                            </div>
                                            {% else %}
                                            Member
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>

                            {#  Pending invitation requests #}
                            <table data-filter-by="pending" class="table-members-list">
                            {% if group.gaccess.group_membership_requests %}
                                {% for pendingrequest in group.gaccess.group_membership_requests %}
                                    <tr>
                                        <td data-id="picture">
                                            {% if pendingrequest.request_from.userprofile and pendingrequest.request_from.userprofile.picture.url %}
                                                <div style="background-image: url('{{ pendingrequest.request_from.userprofile.picture.url }}');"
                                                     class="profile-pic-thumbnail round-image pull-left">
                                                </div>
                                            {% else %}
                                                <div class="profile-pic-thumbnail-small round-image user-icon"></div>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <h4><strong><a
                                                    href="#">{{ pendingrequest.request_from|best_name }}</a></strong>
                                            </h4>
                                            {% if  pendingrequest.request_from.userprofile.title %}
                                                <span class="text-muted">{{ pendingrequest.request_from.userprofile.title }}</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if profile_user.is_group_owner or profile_user.is_group_editor %}
                                                <form action="/hsapi/_internal/act-on-group-membership-request/{{ pendingrequest.id }}/accept/">
                                                    {% csrf_token %}
                                                    <a href="#" class="btn btn-success btn-act-on-request"
                                                       data-user-action="Accept"
                                                       data-member-id="{{ pendingrequest.request_from.id }}"
                                                       data-name="{{ pendingrequest.request_from|best_name }}"
                                                       data-title="{% if pendingrequest.request_from.userprofile.title %}{{ pendingrequest.request_from.userprofile.title }}{% endif %}"><span
                                                            class="glyphicon glyphicon-ok"></span>&nbsp;Accept</a>
                                                </form>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if profile_user.is_group_owner or profile_user.is_group_editor %}
                                                <form action="/hsapi/_internal/act-on-group-membership-request/{{ pendingrequest.id }}/reject/">
                                                    {% csrf_token %}
                                                    <a href="#" class="btn btn-default btn-act-on-request"
                                                       data-user-action="Reject"><span
                                                            class="glyphicon glyphicon-remove"></span>&nbsp;Reject</a>
                                                </form>
                                            {% endif %}
                                        </td>
                                    </tr>

                                {% endfor %}
                                {% else %}
                                <tr class="no-pending-requests"><td><i>No pending requests.</i></td></tr>
                            {% endif %}
                            </table>

                        </div>
                    </div>
                </div>

                <div role="tabpanel" class="tab-pane fade" id="resources">
                     <div class="row">
                        <div class="col-lg-2" id="facets">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <span class="glyphicon glyphicon glyphicon-search"></span>
                                        <a data-toggle="collapse" class="accordion-toggle" data-parent="#accordion" href="#filter">&nbsp;Shared by</a></h4>
                                </div>
                                <div id="filter" class="facet-list panel-collapse collapse in">
                                    <div class="panel-body">
                                        <div class="list-group">
                                            <ul class="list-group inputs-group">
                                                <li class="list-group-item">
                                                    <span data-facet="owned" class="badge">0</span>
                                                    <label class="checkbox noselect">
                                                        <input type="checkbox" data-facet="owned" value="Owned">Some User Name</label>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>

{#                            <div class="panel panel-default">#}
{#                                <div class="panel-heading">#}
{#                                    <h4 class="panel-title">#}
{#                                        <span class="glyphicon glyphicon-tags"></span>#}
{#                                        <a data-toggle="collapse" class="accordion-toggle" data-parent="#accordion" href="#labels">&nbsp;&nbsp;Labels</a></h4>#}
{#                                </div>#}
{#                                <div id="labels" class="facet-list panel-collapse collapse in">#}
{#                                    <div class="panel-body">#}
{#                                        <div class="list-group">#}
{#                                            <ul id="user-labels-left" class="list-group inputs-group">#}
{##}
{#                                            </ul>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
                        </div>
                        <div class="col-lg-10" id="items">
                            <div class="row">
                                <div class="col-sm-8 col-xs-12 pull-right">
                                    <div id="search-container" class="input-group">
                                        <span class="glyphicon glyphicon-search search-icon"></span>
                                        <input id="resource-search-input" type="text" class="form-control" placeholder="Search"/>

                                        <div class="input-group-btn">
                                            <div class="btn-group" role="group">
                                                <div class="dropdown dropdown-lg">
                                                    <span id="btn-clear-search-input" class="glyphicon glyphicon-remove-sign btn-clear-search"></span>

                                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                                                            aria-expanded="false"><span class="caret"></span></button>

                                                    <div class="dropdown-menu dropdown-menu-left" role="menu">
                                                        <form class="form-horizontal" role="form">
                                                            <div class="form-group">
                                                                <label for="filter">Resource Type</label>
                                                                <select id="input-resource-type" class="form-control pull-left">
                                                                    <option value="" selected>All</option>
                                                                    <option value="generic">Generic</option>
                                                                    <option value="geographic feature">Geographic Feature (ESRI Shapefiles)</option>
                                                                    <option value="geographic raster">Geographic Raster</option>
                                                                    <option value="his referenced time series">HIS Referenced Time Series</option>
                                                                    <option value="model instance resource">Model Instance</option>
                                                                    <option value="model program">Model Program</option>
                                                                    <option value="multidimensional">Multidimensional (NetCDF)</option>
                                                                    <option value="script resource">Script Resource</option>
                                                                    <option value="swat model instance resource">Swat Model Instance</option>
                                                                    <option value="time series">Time Series</option>
                                                                    <option value="web app resource">Web App</option>
                                                                </select>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="contain">Author</label>
                                                                <input id="input-author" class="form-control" type="text"/>
                                                                <span id="btn-clear-author-input" class="glyphicon glyphicon-remove-sign btn-clear-search-inline"></span>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="contain">Subject</label>
                                                                <input id="input-subject" class="form-control" type="text"/>
                                                                <span id="btn-clear-subject-input" class="glyphicon glyphicon-remove-sign btn-clear-search-inline"></span>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                 </div>
{#                                <div class="col-sm-4 col-xs-12 pull-left">#}
{#                                    <div id="resource-actions-container" class="noselect">#}
{#                                        <span id="btn-label" class="glyphicon glyphicon-tags dropdown-toggle"#}
{#                                              data-toggle="dropdown" aria-expanded="false" title="Label"></span>#}
{##}
{#                                        <span id="btn-favorite" class="glyphicon  glyphicon-star" data-toggle="tooltip" data-placement="bottom" title="Favorite"></span>#}
{##}
{#                                        <div id="toolbar-labels-dropdown" class="dropdown-menu" role="menu">#}
{#                                            <div class="panel-body" role="form">#}
{#                                                <span>Label as:</span>#}
{#                                                <ul class="list-group list-labels">#}
{#                                                    <li class="divider persist"></li>#}
{#                                                    <li class="list-group-item persist" data-toggle="modal" data-target="#modalCreateLabel">#}
{#                                                        <span style="color:#5cb85c" class="glyphicon glyphicon-plus"></span>&nbsp;&nbsp;&nbsp;&nbsp;Create New Label</li>#}
{#                                                    <li class="list-group-item persist" data-toggle="modal" data-target="#modalManageLabels">#}
{#                                                        <span style="color:#0A91AB" class="glyphicon glyphicon-folder-open"></span>&nbsp;&nbsp;&nbsp;&nbsp;Manage Labels</li>#}
{#                                                </ul>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                </div>#}
                            </div>

                            <!-- /input-group -->
                            <table id="item-selectors" class="table-hover table-striped resource-custom-table">
                                <thead>
                                <tr>
                                    <th><input class="all-rows-selector" type="checkbox"></th>
                                    <th>Type</th>
                                    <th>Title</th>
                                    <th>Owners</th>
                                    <th>Last modified</th>
                                    <th>Subject</th>{# Used in table processing #}
                                    <th>Authors</th>{# Used in table processing #}
                                    <th>Permission Level</th>{# Used in table processing #}
                                    <th>Labels</th>{# Used in table processing #}
                                    <th>Favorite</th>{# Used in table processing #}
                                    <th>Last modified</th>{# Used in table processing #}
                                    <th>Sharing Status</th>{# Used in table processing #}
                                </tr>
                                </thead>
                                <tbody>
                                    {% for res in group.gaccess.view_resources %}
                                        <tr data-tr-index="{{ forloop.counter0 }}">
                                            <td>
{#                                                <input class="row-selector" type="checkbox">#}
{#                                                {% if res.is_favorite %}#}
{#                                                    <span data-form-id="form-favorite-{{ res.short_id }}" data-form-type="toggle-favorite"#}
{#                                                          class="glyphicon glyphicon-star btn-inline-favorite isfavorite"></span>#}
{##}
{#                                                    <form class="hidden-form" data-id="form-favorite-{{ res.short_id }}"#}
{#                                                          action="/hsapi/_internal/{{ res.short_id }}/label-resource-action/"#}
{#                                                          method="post">#}
{#                                                        {% csrf_token %}#}
{#                                                        <input type="hidden" name="action" value="DELETE">#}
{#                                                        <input type="hidden" name="label_type" value="FAVORITE">#}
{#                                                    </form>#}
{#                                                {% else %}#}
{#                                                    <span data-form-id="form-favorite-{{ res.short_id }}" data-form-type="toggle-favorite"#}
{#                                                          class="glyphicon glyphicon-star btn-inline-favorite"></span>#}
{##}
{#                                                    <form class="hidden-form" data-id="form-favorite-{{ res.short_id }}"#}
{#                                                          action="/hsapi/_internal/{{ res.short_id }}/label-resource-action/"#}
{#                                                          method="post">#}
{#                                                        {% csrf_token %}#}
{#                                                        <input type="hidden" name="action" value="CREATE">#}
{#                                                        <input type="hidden" name="label_type" value="FAVORITE">#}
{#                                                    </form>#}
{#                                                {% endif %}#}
{##}
{#                                                <span class="glyphicon glyphicon-tag btn-inline-label" data-toggle="dropdown" aria-expanded="false"></span>#}
{##}
{#                                                <div class="dropdown-menu inline-dropdown" role="menu">#}
{#                                                    <div class="panel-body" role="form">#}
{#                                                        <ul data-resource-id="{{ res.short_id }}" class="list-group list-labels">#}
{#                                                        </ul>#}
{#                                                    </div>#}
{#                                                </div>#}
                                            </td>
                                            <td>
                                                <span class="resource-type-text">{{ res|resource_type }}</span>
                                                {% if res|resource_type == "Generic" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/generic48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "Geographic Raster" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/geographicraster48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "Model Program Resource" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/modelprogram48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "Model Instance Resource" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/modelinstance48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "SWAT Model Instance Resource" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/swat48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "Multidimensional (NetCDF)" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/multidimensional48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "Time Series" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/timeseries48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "Geographic Feature (ESRI Shapefiles)" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/geographicfeature48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "Web App Resource" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/webapp48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "HIS Referenced Time Series" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/his48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% elif res|resource_type == "Script Resource" %}
                                                    <img src="{{ STATIC_URL }}img/resource-icons/script48x48.png"
                                                         alt="{{ res|resource_type }}" title="{{ res|resource_type }}" class="table-res-type-icon"/>
                                                {% endif %}

                                                {#  Sharing Status icons #}
                                                {% if res.raccess.published %}
                                                    <img src="{{ STATIC_URL }}img/published.png"
                                                         alt="Published Resource" title="Published"/>
                                                {% elif res.raccess.public %}
                                                    <img src="{{ STATIC_URL }}img/public.png"
                                                         alt="Public Resource" title="Public"/>
                                                {% elif res.raccess.discoverable %}
                                                    <img src="{{ STATIC_URL }}img/discoverable.png"
                                                         alt="Discoverable Resource" title="Discoverable"/>
                                                {% else %}
                                                    <img src="{{ STATIC_URL }}img/private.png"
                                                         alt="Private Resource" title="Private"/>
                                                {% endif %}

                                                {% if res.raccess.published %}
                                                    {% if "pending" in cm.doi or "failure" in cm.doi %}
                                                        <img src="{{ STATIC_URL }}img/pending.png" alt="Pending Publication"
                                                             title="Pending Publication. Note that the DOI will not be available until it has been registered and activated."/>
                                                    {% endif %}
                                                {% else %}
                                                    {% if res.raccess.shareable %}
                                                        <img src="{{ STATIC_URL }}img/shareable.png" alt="Sharable Resource"
                                                             title="Shareable"/>
                                                    {% else %}
                                                        <img src="{{ STATIC_URL }}img/non-shareable.png" alt="Non Sharable Resource"
                                                             title="Not Shareable"/>
                                                    {% endif %}
                                                {% endif %}
                                            </td>
                                            <td>
                                                <strong><a href="{{ res.get_absolute_url }}">{{ res.metadata.title }}</a></strong>
                                            </td>
                                            <td>{% for owner in res.raccess.owners.all %}
                                                  {% if forloop.counter0 > 0 %} · {% endif %}
                                                <span>{{ owner|contact|safe }}</span>
                                            {% endfor %}</td>
                                            <td>{{ res.updated|date }}, {{ res.updated|time }}</td>
                                            <td>
                                                {% for kw in res.metadata.subjects.all %}
                                                   {% if forloop.counter0 > 0 %},{% endif %}{{ kw.value}}
                                                {% endfor %}
                                            </td>
                                            <td>
                                                {% for creator in res.metadata.creators.all %}
                                                    {% if forloop.counter0 != 0 %}<span> · </span>{% endif %}
                                                    {% if creator.description %}
                                                        <a href="{{ creator.description }}">{{ creator.name }}</a>
                                                    {% else %}
                                                        <span>{{ creator.name }}</span>
                                                    {% endif %}
                                                {% endfor %}
                                            </td>
                                            {% if res.owned %}
                                                <td>Owned</td>
                                            {% elif res.editable %}
                                                <td>Editable</td>
                                            {% elif res.viewable %}
                                                <td>Viewable</td>
                                            {% else %}
                                                <td></td>
                                            {% endif %}
                                            <td class="col-labels">
                                                {% for label in res.labels %}
                                                    {% if forloop.counter0 > 0 %},{% endif %}{{ label }}
                                                {% endfor %}
                                            </td>
                                            <td class="col-is-favorite">
                                                {% if res.is_favorite %}
                                                    Favorite
                                                {% endif %}
                                            </td>
                                            <td>{{ res.updated|date:"Y/m/d H:i:s" }}</td>
                                            <td>
                                                {% if res.raccess.published %}
                                                    Published
                                                {% elif res.raccess.public %}
                                                    Public
                                                {% elif res.raccess.discoverable %}
                                                    Discoverable
                                                {% else %}
                                                    Private
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>

                            <div class="panel-group" role="tablist">
                                <div class="panel panel-default">
                                    <div class="panel-heading" role="tab" id="headingLegend">
                                        <h4 class="panel-title">
                                            <span class="glyphicon glyphicon-info-sign"></span>&nbsp;
                                            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#legend-collapse"
                                               aria-expanded="true" aria-controls="legend-collapse">
                                                Legend
                                            </a>
                                        </h4>
                                    </div>

                                    <div id="legend-collapse" class="panel-collapse collapse" role="tabpanel"
                                         aria-labelledby="headingLegend">
                                        <div class="panel-body">
                                            <div class="row">
                                                <div class="col-xs-12 col-sm-5">
                                                    <div class="row">
                                                        <div class="col-sm-12"><label>Sharing and Access</label></div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/public.png" alt="Public Resource"/>
                                                            <small>Public</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/private.png" alt="Private Resource"/>
                                                            <small>Private</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/discoverable.png" alt="Discoverable Resource"/>
                                                            <small>Discoverable</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/published.png" alt="Published Resource"/>
                                                            <small>Published</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/pending.png" alt="Pending Publication"/>
                                                            <small>Pending publication</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/shareable.png" alt="Sharable Resource"/>
                                                            <small>Shareable</small>
                                                        </div>

                                                        <div class="col-sm-8">
                                                            <img src="{{ STATIC_URL }}img/non-shareable.png" alt="Non Sharable Resource"/>
                                                            <small>Not shareable</small>
                                                        </div>

                                                    </div>
                                                </div>

                                                <div class="col-xs-12 col-sm-7">
                                                    <div class="row" id="legend-resource-type">
                                                        <div class="col-sm-12"><label>Resource types</label></div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/generic48x48.png"
                                                                 alt="Generic Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;Generic</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/geographicfeature48x48.png"
                                                                 alt="Geographic Feature Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;Geographic Feature</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/geographicraster48x48.png"
                                                                 alt="Geographic Raster Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;Geographic Raster</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/modelinstance48x48.png"
                                                                 alt="Model Instance Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;Model Instance</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/swat48x48.png"
                                                                 alt="SWAT Model Instance Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;SWAT Model Instance</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/modelprogram48x48.png"
                                                                 alt="Model Program Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;Model Program</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/multidimensional48x48.png"
                                                                 alt="Multidimensional Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;Multidimensional</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/timeseries48x48.png"
                                                                 alt="Time Series Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;Time Series</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/his48x48.png"
                                                                 alt="HIS Referenced Time Series Resource Icon"
                                                                 class="table-res-type-icon"/>
                                                            <small>&nbsp;HIS Referenced Time Series</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/webapp48x48.png"
                                                                 alt="Web App Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;Web App</small>
                                                        </div>

                                                        <div class="col-sm-6">
                                                            <img src="{{ STATIC_URL }}img/resource-icons/script48x48.png"
                                                                 alt="Script Resource Icon" class="table-res-type-icon"/>
                                                            <small>&nbsp;Script</small>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                     </div>
                 </div>
            </div>
        </div>
    </div>

    <!-- Edit Group Modal -->
    <div class="modal fade" id="edit-group-dialog" tabindex="-1" role="dialog"
         aria-labelledby="Invite">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form action="/hsapi/_internal/update-user-group/{{ group.id }}" method="POST" enctype="multipart/form-data">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-label="Close"><span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">Create New Group</h4>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <div class="row">
                            {# Group Name #}
                            <fieldset class="col-sm-12">
                                <label>Group Name *</label>
                                <input class="form-control form-required" name="name" value="{{ group.name }}">
                            </fieldset>

                            {# Group Description #}
                            <fieldset class="col-sm-12">
                                <label>About this group *</label>
                                <textarea class="form-control" name="description">{{ group.gaccess.description }}</textarea>
                            </fieldset>

                            {# Purpose #}
                            <fieldset class="col-sm-12">
                                <label>Purpose</label>
                                <input class="form-control" name="purpose" value="{{ group.gaccess.purpose }}">
                            </fieldset>

                            <br>

                            {# Picture #}
                            <div class="col-sm-12">
                                <fieldset>
                                    <label>Add a photo</label>

                                    <div class="input-group">
                                        <span class="input-group-btn">
                                            <span id="cv-custom-upload" class="btn btn-default btn-file">
                                                Browse&hellip; <input class="upload-picture" type="file" name="picture">
                                            </span>
                                        </span>
                                        <input type="text" class="form-control" readonly>
                                    </div>
                                </fieldset>
                            </div>

                            <br>

                            {# Privacy #}
                            <fieldset class="col-sm-12">
                                <label>Privacy *</label>
                                <div class="radio">
                                    <label>
                                        <input type="radio" name="privacy_level" value="public" {% if group.gaccess.public and group.gaccess.discoverable %}checked{% endif %}>Public
                                        <div class="text-muted">Other users can find the group and see who has
                                            membership.
                                        </div>
                                    </label>
                                </div>

                                <div class="radio">
                                    <label>
                                        <input type="radio" name="privacy_level" value="discoverable" {% if not group.gaccess.public and group.gaccess.discoverable %}checked{% endif %}>Discoverable
                                        <div class="text-muted">Other users can find this group, but membership
                                            information is hidden.
                                        </div>
                                    </label>
                                </div>

                                <div class="radio">
                                    <label>
                                        <input type="radio" name="privacy_level" value="private" {% if not group.gaccess.public and not group.gaccess.discoverable %}checked{% endif %}>Private
                                        <div class="text-muted">Other users can not find this group.</div>
                                    </label>
                                </div>
                            </fieldset>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Invite to Group Modal -->
    <div class="modal fade" id="invite-dialog" tabindex="-1" role="dialog"
         aria-labelledby="Invite">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-label="Close"><span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="Invite">Invite People</h4>
                </div>
                <form id="invite-to-group" action="/hsapi/_internal/make-group-membership-request/{{ group.id }}/">
                    <div class="modal-body">
                        <div id="div-invite-people">
                            {% csrf_token %}
                            {{ add_view_user_form.user }}
                            <form action="">
                                <a id="btn-invite"  onclick="group_invite_ajax_submit(); return false;"
                                   class="btn btn-add-access btn-success pull-left glyphicon glyphicon-send"><span class="button-label">&nbsp;&nbsp;Send Invitation</span>
                                </a>
                            </form>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.10/js/jquery.dataTables.js"></script>
        <script>
        var colDefs = [
            {
                "targets": [0],     // Row selector and controls
                "visible": false,
            },
            {
                "targets": [1],     // Resource type
                "width": "100px"
            },
            {
                "targets": [0],     // Actions
                "orderable": false,
                "searchable": false,
                "width": "70px"
            },
            {
                "targets": [4],     // Last modified
                "iDataSort": 10
            },
            {
                "targets": [5],     // Subject
                "visible": false,
                "searchable": true
            },
            {
                "targets": [6],     // Authors
                "visible": false,
                "searchable": true
            },
            {
                "targets": [7],     // Permission level
                "visible": false,
                "searchable": true
            },
            {
                "targets": [8],     // Labels
                "visible": false,
                "searchable": true
            },
            {
                "targets": [9],     // Favorite
                "visible": false,
                "searchable": true
            },
            {
                "targets": [10],     // Last modified (for sorting)
                "visible": false,
                "searchable": true
            },
            {
                "targets": [11],     // Sharing status
                "visible": false,
                "searchable": false
            }
        ];
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/hs_resource_table.js"></script>
    <script>
        function group_invite_ajax_submit() {
            if (!$("#id_user-deck > .hilight").length) {
                return false; // If no user selected, ignore the request
            }
            var share_with = $("#id_user-deck > .hilight")[0].getAttribute("data-value");
            var form = $("#invite-to-group");
            var datastring = form.serialize();
            var url = form.attr('action') + share_with + "/";

            $.ajax({
                type: "POST",
                url: url,
                dataType: 'html',
                data: datastring,
                success: function (result) {
                    $(".hilight > span").click(); // Clears the search field
                    $("#invite-dialog .modal-body").prepend('<div class="alert alert-success" role="alert"><span class="glyphicon glyphicon-ok glyphicon"></span> An invitation to join has been sent.</strong></div>');

                    setTimeout(function () {
                       $("#invite-dialog .modal-body .alert").fadeOut();
                    }, 3000);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    $("#invite-dialog .modal-body").prepend('<div class="alert alert-error" role="alert"><span class="glyphicon glyphicon-ok glyphicon"></span> This invitation could not be sent.</strong></div>');

                    setTimeout(function () {
                        $("#invite-dialog .modal-body .alert").fadeOut();
                    }, 3000);
                }
            });
            //don't submit the form
            return false;
        }

        function onRoleSelect(event) {
            var el = $(event.target);
            $("#selected_role").text(el.text());
            $("#selected_role")[0].setAttribute("data-role", el[0].getAttribute("data-role"));
        }

        function act_on_request_ajax_submit() {
            var target = $(this);
            var form = $(this).closest("form");
            var datastring = form.serialize();
            var url = form.attr('action');
            $.ajax({
                type: "POST",
                url: url,
                dataType: 'html',
                data: datastring,
                success: function (result) {
                    if (target.attr("data-user-action") == "Accept") {
                        // Get a copy of the member row template
                        var rowTemplate = $("#templateRow").clone();

                        var name = target.attr("data-name");
                        var title = target.attr("data-title");
                        var picture = target.parent().parent().parent().find("[data-id='picture']");

                        rowTemplate.find("[data-id='name']").text(name);
                        rowTemplate.find("[data-id='title']").text(title);
                        var forms = rowTemplate.find("form");
                        for (var i = 0; i < forms.length; i++) {
                            var newAction = $(forms[i]).attr("action").replace("member_id", target.attr("data-member-id"));
                            $(forms[i]).attr("action", newAction);
                        }
                        rowTemplate.prepend(picture);

                        $("#all-members-table tbody").append($("<tr data-filter-by='view-user' style='display: none;'>" + rowTemplate.html() + "</tr>"));
                        $(".btn-share-group").click(share_group_ajax_submit);
                        $(".btn-unshare-group").click(unshare_group_ajax_submit);
                    }

                    target.parent().parent().parent().remove();
                    updateMembersLabelCount();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("error");
                }
            });
            //don't submit the form
            return false;
        }

        function share_group_ajax_submit() {
            var target = $(this);
            var form = target.closest("form");
            var role = target.attr("data-role");
            var datastring = form.serialize();
            var url = form.attr('action');
            $.ajax({
                type: "POST",
                url: url,
                dataType: 'html',
                data: datastring,
                success: function (result) {
                    var dropdownButton = target.parent().parent().parent().parent().find(".dropdown-toggle");
                    dropdownButton.text(role);
                    dropdownButton.append('&nbsp;<span class="caret"></span>');

                    var row = target.parent().parent().parent().parent().parent().parent();
                    if (role == "Owner") {
                        row.attr("data-filter-by", "edit-user");
                    }
                    else if (role == "Member") {
                        row.attr("data-filter-by", "view-user");
                    }

                    dropdownButton.dropdown("toggle");
                    updateMembersLabelCount();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("error");
                }
            });
            //don't submit the form
            return false;
        }

        function unshare_group_ajax_submit() {
            var target = $(this);
            var form = target.closest("form");
            var datastring = form.serialize();
            var url = form.attr('action');
            $.ajax({
                type: "POST",
                url: url,
                dataType: 'html',
                data: datastring,
                success: function (result) {
                    var row = target.parent().parent().parent().parent().parent().parent();
                    row.remove();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("error");
                }
            });
            //don't submit the form
            return false;
        }

        function updateMembersLabelCount() {
            var viewCount = $("#all-members-table tr[data-filter-by='view-user']").length - 1;  // Subtract hidden template row
            var editCount = $("#all-members-table tr[data-filter-by='edit-user']").length;
            var ownersCount = $("#all-members-table tr[data-filter-by='creator']").length;
            var pendingCount = $("table[data-filter-by='pending'] tr:not('.no-pending-requests')").length;

            $("#members-filter .badge[data-filter-by='All']").text(viewCount + editCount + ownersCount);
            $("#members-filter .badge[data-filter-by='Owners']").text(editCount + ownersCount);
            $("#members-filter .badge[data-filter-by='Pending']").text(pendingCount);
        }

        $(document).ready(function () {
            // Abstract collapse toggle
            $(".show-more-btn").click(function () {
                if ($(this).parent().find(".activity-description").css("max-height") == "50px") {
                    var block = $(this).parent().find(".activity-description");

                    block.css("max-height", "initial"); // Set max-height to initial temporarily.
                    var maxHeight = block.height();    // Save the max height
                    block.css("max-height", "50px");    // Restore

                    block.animate({'max-height': maxHeight}, 300); // Animate to max height
                    $(this).text("▲");
                    $(this).attr("title", "Show less");
                }
                else {
                    $(this).parent().find(".activity-description").animate({'max-height': "50px"}, 300);
                    $(this).attr("title", "Show more");
                    $(this).text("···");
                }
            });

            $("#list-roles a").click(onRoleSelect);

            $("#id_user-autocomplete").attr("placeholder", "Search by name or username");

            // Filter
            $("#members").find(".table-members-list").hide();
            $("#members").find(".table-members-list.active").show();

            $("#members-filter tr").click(function() {
                $("#members").find(".table-members-list tr").hide();
                $("table[data-filter-by='pending'] tr").hide();
                $("table[data-filter-by='pending']").hide();

                var dataFilter = $(this).attr("data-filter-by");
                if (dataFilter == "edit-user") {
                    $("#members").find(".table-members-list tr[data-filter-by='" + dataFilter + "']").fadeIn();
                    $("#members").find(".table-members-list tr[data-filter-by='" + "creator" + "']").fadeIn();
                }
                else if (dataFilter == "all") {
                    $("#members").find(".table-members-list tr").addClass("active").fadeIn();
                }
                else if(dataFilter == "pending") {
                    $("#members").find(".table-members-list tr").addClass("active").hide();
                    $("table[data-filter-by='pending'] tr").fadeIn();
                    $("table[data-filter-by='pending']").fadeIn();
                }

                $(this).parent().find("tr").removeClass("active");
                $(this).addClass("active");
            });

            $(".btn-act-on-request").click(act_on_request_ajax_submit);
            $(".btn-share-group").click(share_group_ajax_submit);
            $(".btn-unshare-group").click(unshare_group_ajax_submit);
            $("#btn-leave-group").click(function(){
                $(this).closest("form").submit();
            });

            // Initialize filters counters
            updateMembersLabelCount();

        });
    </script>
{% endblock %}